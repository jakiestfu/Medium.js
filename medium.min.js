(function(e,h){var g=e.rangy||null,c=e.Undo||null,f=e.Key={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capsLock:20,escape:27,pageUp:33,pageDown:34,end:35,home:36,leftArrow:37,upArrow:38,rightArrow:39,downArrow:40,insert:45,"delete":46,"0":48,"1":49,"2":50,"3":51,"4":52,"5":53,"6":54,"7":55,"8":56,"9":57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,leftWindow:91,rightWindowKey:92,select:93,numpad0:96,numpad1:97,numpad2:98,numpad3:99,numpad4:100,numpad5:101,numpad6:102,numpad7:103,numpad8:104,numpad9:105,multiply:106,add:107,subtract:109,decimalPoint:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numLock:144,scrollLock:145,semiColon:186,equalSign:187,comma:188,dash:189,period:190,forwardSlash:191,graveAccent:192,openBracket:219,backSlash:220,closeBracket:221,singleQuote:222},b=(function(){var d=function(p){var u=this,q=a.deepExtend({},d.defaultSettings),m=this.settings=a.deepExtend(q,p),j=new d.Cache(),s=new d.Selection(),n=new d.Action(this),t=new d.Cursor(this),r=new d.Undoable(this),l,k,o;for(o in q){if(q.hasOwnProperty(o)){if(typeof q[o]!=="object"&&q.hasOwnProperty(o)&&m.element.getAttribute("data-medium-"+f)){k=m.element.getAttribute("data-medium-"+f);if(k.toLowerCase()==="false"||k.toLowerCase()==="true"){k=k.toLowerCase()==="true"}m[o]=k}}}if(m.modifiers){for(o in m.modifiers){if(m.modifiers.hasOwnProperty(o)){if(typeof(f[o])!=="undefined"){m.modifiers[f[o]]=m.modifiers[o]}}}}if(m.keyContext){for(o in m.keyContext){if(m.keyContext.hasOwnProperty(o)){if(typeof(f[o])!=="undefined"){m.keyContext[f[o]]=m.keyContext[o]}}}}l=m.element;l.contentEditable=true;l.className+=(" "+m.cssClasses.editor)+(" "+m.cssClasses.editor+"-"+m.mode);m.tags=(m.tags||{});if(m.tags.outerLevel){m.tags.outerLevel=m.tags.outerLevel.concat([m.tags.paragraph,m.tags.horizontalRule])}this.settings=m;this.element=l;l.medium=this;this.action=n;this.cache=j;this.cursor=t;this.utils=a;this.selection=s;u.clean();u.placeholders();n.preserveElementFocus();this.dirty=false;this.undoable=r;this.makeUndoable=r.makeUndoable;if(m.drag){u.drag=new d.Drag(u);u.drag.setup()}n.setup();j.initialized=true;this.makeUndoable(true)};d.prototype={placeholders:function(){if(!e.getComputedStyle){return}var r=this.settings,n=this.placeholder||(this.placeholder=h.createElement("div")),k=this.element,i=n.style,o=e.getComputedStyle(k,null),m=function(s){return o.getPropertyValue(s)},p=a.text(k),q=this.cursor,l=k.children.length,j=d.activeElement===k;k.placeholder=n;if(!j&&p.length<1&&l<2){if(k.placeHolderActive){return}if(!k.innerHTML.match("<"+r.tags.paragraph)){k.innerHTML=""}if(r.placeholder.length>0){if(!n.setup){n.setup=true;i.background=m("background");i.backgroundColor=m("background-color");i.fontSize=m("font-size");i.color=o.color;i.marginTop=m("margin-top");i.marginBottom=m("margin-bottom");i.marginLeft=m("margin-left");i.marginRight=m("margin-right");i.paddingTop=m("padding-top");i.paddingBottom=m("padding-bottom");i.paddingLeft=m("padding-left");i.paddingRight=m("padding-right");i.borderTopWidth=m("border-top-width");i.borderTopColor=m("border-top-color");i.borderTopStyle=m("border-top-style");i.borderBottomWidth=m("border-bottom-width");i.borderBottomColor=m("border-bottom-color");i.borderBottomStyle=m("border-bottom-style");i.borderLeftWidth=m("border-left-width");i.borderLeftColor=m("border-left-color");i.borderLeftStyle=m("border-left-style");i.borderRightWidth=m("border-right-width");i.borderRightColor=m("border-right-color");i.borderRightStyle=m("border-right-style");n.className=r.cssClasses.placeholder+" "+r.cssClasses.placeholder+"-"+r.mode;n.innerHTML="<div>"+r.placeholder+"</div>";k.parentNode.insertBefore(n,k)}k.className+=" "+r.cssClasses.clear;i.display="";i.minHeight=k.clientHeight+"px";i.minWidth=k.clientWidth+"px";if(r.mode!==d.inlineMode&&r.mode!==d.inlineRichMode){this.setupContents();if(l===0&&k.firstChild){q.set(this,0,k.firstChild)}}}k.placeHolderActive=true}else{if(k.placeHolderActive){k.placeHolderActive=false;i.display="none";k.className=a.trim(k.className.replace(r.cssClasses.clear,""));this.setupContents()}}},clean:function(i){var v=this.settings,m=v.cssClasses.placeholder,n=(v.attributes||{}).remove||[],w=v.tags||{},q=w.outerLevel||null,r=w.innerLevel||null,x={},u={},p=(w.paragraph||"").toUpperCase(),l=this.html,o,t,k;i=i||v.element;if(v.mode===d.inlineRichMode){q=v.tags.innerLevel}if(q!==null){for(k=0;k<q.length;k++){x[q[k].toUpperCase()]=true}}if(r!==null){for(k=0;k<r.length;k++){u[r[k].toUpperCase()]=true}}a.traverseAll(i,{element:function(C,s,A,y){var B=C.nodeName,j=true,z;for(k=0;k<n.length;k++){o=n[k];if(C.hasAttribute(o)){z=C.getAttribute(o);if(z!==m&&(!z.match("medium-")&&o==="class")){C.removeAttribute(o)}}}if(q===null&&r===null){return}if(A===1&&x[B]!==undefined){j=false}else{if(A>1&&u[B]!==undefined){j=false}}if(j){if(e.getComputedStyle(C,null).getPropertyValue("display")==="block"){if(p.length>0&&p!==B){a.changeTag(C,p)}if(A>1){while(y.childNodes.length>s){y.parentNode.insertBefore(y.lastChild,y.nextSibling)}}}else{switch(B){case"BR":if(C===C.parentNode.lastChild){if(C===C.parentNode.firstChild){break}t=h.createTextNode("");t.innerHTML="&nbsp";C.parentNode.insertBefore(t,C);break}default:while(C.firstChild!==null){C.parentNode.insertBefore(C.firstChild,C)}a.detachNode(C);break}}}}})},insertHtml:function(j,m,k){var i=(new d.Html(this,j)).insert(this.settings.beforeInsertHtml),l=i[i.length-1];if(k===true){a.triggerEvent(this.element,"change")}if(m){m.apply(i)}switch(l.nodeName){case"UL":case"OL":case"DL":if(l.lastChild!==null){this.cursor.moveCursorToEnd(l.lastChild);break}default:this.cursor.moveCursorToEnd(l)}return this},addTag:function(j,i,k,m){if(!this.settings.beforeAddTag(j,i,k,m)){var n=h.createElement(j),l;if(typeof k!=="undefined"&&k===false){n.contentEditable=false}if(n.innerHTML.length==0){n.innerHTML=" "}if(m&&m.nextSibling){m.parentNode.insertBefore(n,m.nextSibling);l=m.nextSibling}else{this.element.appendChild(n);l=this.lastChild()}if(i){this.cache.focusedElement=l;this.cursor.set(this,0,l)}return n}return null},invokeElement:function(k,j,m){var l=this.settings,i=j.remove||[];j=j||{};switch(l.mode){case d.inlineMode:case d.partialMode:return this;default:}if(i.length>0){if(!a.arrayContains(l,"class")){i.push("class")}}(new d.Element(this,k,j)).invoke(this.settings.beforeInvokeElement);if(m===true){a.triggerEvent(this.element,"change")}return this},value:function(i){if(typeof i!=="undefined"){this.element.innerHTML=i;this.clean();this.placeholders();this.makeUndoable()}else{return this.element.innerHTML}return this},focus:function(){var i=this.element;i.focus();return this},select:function(){a.selectNode(d.activeElement=this.element);return this},isActive:function(){return(d.activeElement===this.element)},setupContents:function(){var l=this.element,j=l.children,m=l.childNodes,i,k=this.settings;if(!k.tags.paragraph||j.length>0||k.mode===d.inlineMode||k.mode===d.inlineRichMode){return d.Utilities}if(m.length>0){i=h.createElement(k.tags.paragraph);if(l.innerHTML.match("^[&]nbsp[;]")){l.innerHTML=l.innerHTML.substring(6,l.innerHTML.length-1)}i.innerHTML=l.innerHTML;l.innerHTML="";l.appendChild(i)}else{i=h.createElement(k.tags.paragraph);i.innerHTML="&nbsp;";l.appendChild(i)}return this},destroy:function(){var j=this.element,i=this.settings,k=this.placeholder||null;if(k!==null&&k.setup&&k.parentNode!==null){k.parentNode.removeChild(k);delete j.placeHolderActive}j.removeAttribute("contenteditable");j.className=a.trim(j.className.replace(i.cssClasses.editor,"").replace(i.cssClasses.clear,"").replace(i.cssClasses.editor+"-"+i.mode,""));this.action.destroy();if(this.settings.drag){this.drag.destroy()}},clear:function(){this.element.innerHTML="";this.placeholders()},splitAtCaret:function(){if(!this.isActive()){return null}var i=(e.getSelection||h.selection),o=i(),p=o.focusOffset,n=o.focusNode,k=this.element,j=h.createRange(),m=h.createRange(),l;j.setStart(n,p);m.selectNodeContents(k);j.setEnd(m.endContainer,m.endOffset);l=j.extractContents();return l},deleteSelection:function(){if(!this.isActive()){return}var j=g.getSelection(),i;if(j.rangeCount>0){i=j.getRangeAt(0);i.deleteContents()}},lastChild:function(){return this.element.lastChild},bold:function(){switch(this.settings.mode){case d.partialMode:case d.inlineMode:return this}(new d.Element(this,"bold")).setClean(false).invoke(this.settings.beforeInvokeElement);return this},underline:function(){switch(this.settings.mode){case d.partialMode:case d.inlineMode:return this}(new d.Element(this,"underline")).setClean(false).invoke(this.settings.beforeInvokeElement);return this},italicize:function(){switch(this.settings.mode){case d.partialMode:case d.inlineMode:return this}(new d.Element(this,"italic")).setClean(false).invoke(this.settings.beforeInvokeElement);return this},quote:function(){return this},paste:function(q){var n=this.value(),j=n.length,p,l=this.settings,o=this.selection,k=this.element,r=this,m=function(s){s=s||"";if(s.length>0){k.focus();d.activeElement=k;o.restoreSelection(i);s=a.encodeHtml(s);p=s.length+j;if(l.maxLength>0&&p>l.maxLength){s=s.substring(0,l.maxLength-j)}if(l.mode!==d.inlineMode){s=s.replace(/\n/g,"<br>")}(new d.Html(r,s)).setClean(false).insert(l.beforeInsertHtml,true);r.clean();r.placeholders()}};r.makeUndoable();if(q!==undefined){m(q)}else{if(l.pasteAsText){var i=o.saveSelection();a.pasteHook(this,m)}else{setTimeout(function(){r.clean();r.placeholders()},20)}}return true},undo:function(){var j=this.undoable,i=j.stack,k=i.canUndo();if(k){i.undo()}return this},redo:function(){var j=this.undoable,i=j.stack,k=i.canRedo();if(k){i.redo()}return this}};d.inlineMode="inline";d.partialMode="partial";d.richMode="rich";d.inlineRichMode="inlineRich";d.Messages={pastHere:"Paste Here"};d.defaultSettings={element:null,modifier:"auto",placeholder:"",autofocus:false,autoHR:true,mode:d.richMode,maxLength:-1,modifiers:{b:"bold",i:"italicize",u:"underline"},tags:{"break":"br",horizontalRule:"hr",paragraph:"p",outerLevel:["pre","blockquote","figure"],innerLevel:["a","b","u","i","img","strong"]},cssClasses:{editor:"Medium",pasteHook:"Medium-paste-hook",placeholder:"Medium-placeholder",clear:"Medium-clear"},attributes:{remove:["style","class"]},pasteAsText:true,beforeInvokeElement:function(){},beforeInsertHtml:function(){},maxLengthReached:function(i){},beforeAddTag:function(j,i,k,l){},keyContext:null,drag:false};(function(j,i,l){function k(m){if(m.hasOwnProperty("target")&&m.target.getAttribute("contenteditable")==="false"){a.preventDefaultEvent(m);return false}return true}j.Action=function(m){this.medium=m;this.handledEvents={keydown:null,keyup:null,blur:null,focus:null,paste:null,click:null}};j.Action.prototype={setup:function(){this.handleFocus().handleBlur().handleKeyDown().handleKeyUp().handlePaste().handleClick()},destroy:function(){var m=this.medium.element;a.removeEvent(m,"focus",this.handledEvents.focus).removeEvent(m,"blur",this.handledEvents.blur).removeEvent(m,"keydown",this.handledEvents.keydown).removeEvent(m,"keyup",this.handledEvents.keyup).removeEvent(m,"paste",this.handledEvents.paste).removeEvent(m,"click",this.handledEvents.click)},handleFocus:function(){var m=this.medium,n=m.element;a.addEvent(n,"focus",this.handledEvents.focus=function(o){o=o||i.event;if(!k(o)){return false}j.activeElement=n;m.placeholders()});return this},handleBlur:function(){var m=this.medium,n=m.element;a.addEvent(n,"blur",this.handledEvents.blur=function(o){o=o||i.event;if(j.activeElement===n){j.activeElement=null}m.placeholders()});return this},handleKeyDown:function(){var q=this,n=this.medium,p=n.settings,m=n.cache,o=n.element;a.addEvent(o,"keydown",this.handledEvents.keydown=function(x){x=x||i.event;if(!k(x)){return false}var s=true;if(x.keyCode===229){return}a.isCommand(p,x,function(){m.cmd=true},function(){m.cmd=false});a.isShift(x,function(){m.shift=true},function(){m.shift=false});a.isModifier(p,x,function(A){if(m.cmd){if((p.mode===j.inlineMode)||(p.mode===j.partialMode)){a.preventDefaultEvent(x);return false}var z=typeof A;var y=null;if(z==="function"){y=A}else{y=n[A]}s=y.call(n,x);if(s===false||s===n){a.preventDefaultEvent(x);a.stopPropagation(x)}return true}return false});if(p.maxLength!==-1){var r=a.text(o).length,t=false,w=i.getSelection(),v=a.isSpecial(x),u=a.isNavigational(x);if(w){t=!w.isCollapsed}if(v||u){return true}if(r>=p.maxLength&&!t){p.maxLengthReached(o);a.preventDefaultEvent(x);return false}}switch(x.keyCode){case f.enter:if(q.enterKey(x)===false){a.preventDefaultEvent(x)}break;case f.backspace:case f["delete"]:q.backspaceOrDeleteKey(x);break}return s});return this},handleKeyUp:function(){var q=this,n=this.medium,p=n.settings,m=n.cache,r=n.cursor,o=n.element;a.addEvent(o,"keyup",this.handledEvents.keyup=function(u){u=u||i.event;if(!k(u)){return false}a.isCommand(p,u,function(){m.cmd=false},function(){m.cmd=true});n.clean();n.placeholders();var t;if(p.keyContext!==null&&(t=p.keyContext[u.keyCode])){var s=r.parent();if(s){t.call(n,u,s)}}q.preserveElementFocus()});return this},handlePaste:function(){var u=this.medium,m=u.element,t,o,s,n,q,r,p;a.addEvent(m,"paste",this.handledEvents.paste=function(v){v=v||i.event;if(!k(v)){return false}o=0;a.preventDefaultEvent(v);t="";q=v.clipboardData;if(q&&(n=q.getData)){p=q.types;s=p.length;for(o=0;o<s;o++){r=p[o];switch(r){case"text/plain":return u.paste(q.getData("text/plain"))}}}u.paste()});return this},handleClick:function(){var m=this.medium,n=m.element,o=m.cursor;a.addEvent(n,"click",this.handledEvents.click=function(p){if(!k(p)){o.caretToAfter(p.target)}});return this},enterKey:function(t){var x=this.medium,o=x.element,q=x.settings,m=x.cache,w=x.cursor;if(q.mode===j.inlineMode||q.mode===j.inlineRichMode){return false}if(m.shift){if(q.tags["break"]){x.addTag(q.tags["break"],true);return false}}else{var u=a.atCaret(x)||{},p=o.children,n=u===o.lastChild?o.lastChild:null,s,v,r;if(n&&n!==o.firstChild&&q.autoHR&&q.mode!==j.partialMode&&q.tags.horizontalRule){a.preventDefaultEvent(t);s=a.text(n)===""&&n.nodeName.toLowerCase()===q.tags.paragraph;if(s&&p.length>=2){v=p[p.length-2];if(v.nodeName.toLowerCase()===q.tags.horizontalRule){s=false}}if(s){x.addTag(q.tags.horizontalRule,false,true,u);u=u.nextSibling}if((r=x.addTag(q.tags.paragraph,true,null,u))!==null){r.innerHTML="";w.set(x,0,r)}}}return true},backspaceOrDeleteKey:function(s){var o=this.medium,q=o.settings,p=o.element;if(q.onBackspaceOrDelete!==undefined){var m=q.onBackspaceOrDelete.call(o,s,p);if(m){return}}if(p.lastChild===null){return}var r=p.lastChild,n=r.previousSibling;if(r&&q.tags.horizontalRule&&r.nodeName.toLocaleLowerCase()===q.tags.horizontalRule){p.removeChild(r)}else{if(r&&n&&a.text(r).length<1&&n.nodeName.toLowerCase()===q.tags.horizontalRule&&r.nodeName.toLowerCase()===q.tags.paragraph){p.removeChild(r);p.removeChild(n)}}},preserveElementFocus:function(){var u=i.getSelection?i.getSelection().anchorNode:l.activeElement;if(u){var v=this.medium,m=v.cache,n=v.element,w=v.settings,t=u.parentNode,o=n.children,r=t!==m.focusedElement,p=0,q;if(t===w.element){t=u}for(q=0;q<o.length;q++){if(t===o[q]){p=q;break}}if(r){m.focusedElement=t;m.focusedElementIndex=p}}}}})(d,e,h);(function(i){i.Cache=function(){this.initialized=false;this.cmd=false;this.focusedElement=null}})(d);(function(i){i.Cursor=function(j){this.medium=j};i.Cursor.prototype={set:function(q,m){var j;if(h.createRange){var l=e.getSelection(),p=this.medium.lastChild(),o=a.text(p).length-1,k=m?m:p,n=((typeof q!=="undefined")&&(q!==null)?q:o);j=h.createRange();j.setStart(k,n);j.collapse(true);l.removeAllRanges();l.addRange(j)}else{j=h.body.createTextRange();j.moveToElementText(m);j.collapse(false);j.select()}},moveCursorToEnd:function(l){var k=g.getSelection(),j=g.createRange();j.setStartAfter(l);j.setEnd(l,l.length||l.childNodes.length);k.removeAllRanges();k.addRange(j)},moveCursorToAfter:function(k){var l=g.getSelection();if(l.rangeCount){var j=l.getRangeAt(0);j.collapse(false);j.collapseAfter(k);l.setSingleRange(j)}},parent:function(){var k=null,j;if(e.getSelection){j=e.getSelection().getRangeAt(0);k=j.commonAncestorContainer;k=(k.nodeType===1?k:k.parentNode)}else{if(h.selection){k=h.selection.createRange().parentElement()}}if(k.tagName=="SPAN"){k=k.parentNode}return k},caretToBeginning:function(j){this.set(0,j)},caretToEnd:function(j){this.moveCursorToEnd(j)},caretToAfter:function(j){this.moveCursorToAfter(j)}}})(d);(function(i){i.Drag=function(k){this.medium=k;var m=this,j=this.iconSrc.replace(/[{][{]([a-zA-Z]+)[}][}]/g,function(o,n){if(m.hasOwnProperty(n)){return m[n]}return o}),l=this.icon=h.createElement("img");l.className=this.buttonClass;l.setAttribute("contenteditable","false");l.setAttribute("src",j);this.hide();this.element=null;this.protectedElement=null;this.handledEvents={dragstart:null,dragend:null,mouseover:null,mouseout:null,mousemove:null}};i.Drag.prototype={elementClass:"Medium-focused",buttonClass:"Medium-drag",iconSrc:'data:image/svg+xml;utf8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="21.424px" height="21.424px" viewBox="0 0 21.424 21.424" style="enable-background:new 0 0 21.424 21.424;" xml:space="preserve">	<g>		<g>			<path style="fill:{{iconColor}};" d="M13.616,17.709L13.616,17.709h0.781l-3.686,3.715l-3.685-3.715h0.781l0,0H13.616z M13.616,17.709 M14.007,17.709 M12.555,19.566 M8.87,19.566 M7.418,17.709 M7.809,17.709 M10.712,17.709"/>			<path style="fill:{{iconColor}};" d="M13.616,3.715L13.616,3.715h0.781L10.712,0L7.027,3.715h0.781l0,0H13.616z M13.616,3.715 M14.007,3.715 M12.555,1.858 M8.87,1.858 M7.418,3.715 M7.809,3.715 M10.712,3.715"/>			<path style="fill:{{iconColor}};" d="M3.716,13.616L3.716,13.616v0.781L0,10.712l3.716-3.685v0.781l0,0V13.616z M3.716,13.616 M3.716,14.007 M1.858,12.555 M1.858,8.87 M3.716,7.417 M3.716,7.808 M3.716,10.712"/>			<path style="fill:{{iconColor}};" d="M17.709,13.616L17.709,13.616v0.781l3.715-3.685l-3.715-3.685v0.781l0,0V13.616z M17.709,13.616 M17.709,14.007 M19.566,12.555 M19.566,8.87 M17.709,7.417 M17.709,7.808 M17.709,10.712"/>		</g>		<path style="fill-rule:evenodd;clip-rule:evenodd;fill:{{iconColor}};" d="M10.712,6.608c2.267,0,4.104,1.838,4.104,4.104 c0,2.266-1.837,4.104-4.104,4.104c-2.266,0-4.104-1.837-4.104-4.104C6.608,8.446,8.446,6.608,10.712,6.608L10.712,6.608z M10.712,7.515c-1.765,0-3.196,1.432-3.196,3.197s1.432,3.197,3.196,3.197c1.766,0,3.197-1.432,3.197-3.197 S12.478,7.515,10.712,7.515z"/>	</g></svg>',iconColor:"#231F20",setup:function(){this.handleDragstart().handleDragend().handleMouseover().handleMouseout().handleMousemove()},destroy:function(){a.removeEvent(this.icon,"dragstart",this.handledEvents.dragstart).removeEvent(this.icon,"dragend",this.handledEvents.dragend).removeEvent(this.icon,"mouseover",this.handledEvents.mouseover).removeEvent(this.icon,"mouseout",this.handledEvents.mouseout).removeEvent(this.medium.element,"mousemove",this.handledEvents.mousemove)},hide:function(){a.hide(this.icon)},handleDragstart:function(){var j=this;a.addEvent(this.icon,"dragstart",this.handledEvents.dragstart=function(k){if(j.protectedElement!==null){return}k=k||e.event;j.protectedElement=a.detachNode(j.element);j.icon.style.opacity=0});return this},handleDragend:function(){var j=this;a.addEvent(this.icon,"dragend",this.handledEvents.dragend=h.body.ondragend=function(k){if(j.protectedElement===null){return}setTimeout(function(){j.cleanCanvas();j.protectedElement=null},1)});return this},handleMouseover:function(){var j=this;a.addEvent(this.icon,"mouseover",this.handledEvents.mouseover=function(k){if(j.protectedElement!==null){return}a.stopPropagation(k).addClass(j.element,j.elementClass)});return this},handleMouseout:function(){var j=this;a.addEvent(this.icon,"mouseout",this.handledEvents.mouseout=function(k){if(j.protectedElement!==null){return}a.stopPropagation(k).removeClass(j.element,j.elementClass)});return this},handleMousemove:function(){var j=this;a.addEvent(this.medium.element,"mousemove",this.handledEvents.mousemove=function(l){l=l||e.event;var k=l.target||{};if(k.getAttribute("contenteditable")==="false"){j.show(k)}});return this},show:function(k){if(k===this.icon&&this.protectedElement===null){return}this.element=k;var j=this.icon.style,m=k.offsetLeft,l=k.offsetTop;k.dragIcon=this.icon;k.parentNode.appendChild(this.icon);j.opacity=1;j.left=m+"px";j.top=l+"px";a.show(this.icon)},cleanCanvas:function(){var l,j=false,k=h.getElementsByClassName(this.buttonClass);this.icon.style.opacity=1;while(k.length>0){if(a.isVisible(l=k[0])){if(!j){l.parentNode.insertBefore(this.element,l);j=true}a.detachNode(l)}}a.detachNode(this.icon)}}})(d);(function(i){i.Element=function(k,l,j){this.medium=k;this.element=k.element;switch(l.toLowerCase()){case"bold":this.tagName="b";break;case"italic":this.tagName="i";break;case"underline":this.tagName="u";break;default:this.tagName=l}this.attributes=j||{};this.clean=true};i.Element.prototype={invoke:function(n){if(i.activeElement===this.element){if(n){n.apply(this)}var j=this.attributes,m=this.tagName.toLowerCase(),l,k;if(j.className!==undefined){k=(j.className.split[" "]||[j.className]).shift();delete j.className}else{k="medium-"+m}l=g.createClassApplier(k,{elementTagName:m,elementAttributes:this.attributes});this.medium.makeUndoable();l.toggleSelection(e);if(this.clean){this.medium.clean();this.medium.placeholders()}}},setClean:function(j){this.clean=j;return this}}})(d);(function(i){i.Html=function(j,k){this.html=k;this.medium=j;this.clean=true;this.injector=new i.Injector()};i.Html.prototype={insert:function(l,k){if(i.activeElement===this.medium.element){if(l){l.apply(this)}var j=this.injector.inject(this.html,k);if(this.clean){this.medium.clean();this.medium.placeholders()}this.medium.makeUndoable();return j}else{return null}},setClean:function(j){this.clean=j;return this}}})(d);(function(i){i.Injector=function(){};i.Injector.prototype={inject:function(l){var k=[],n,j=false;if(typeof l==="string"){var q=h.createElement("div");q.innerHTML=l;n=q.childNodes;j=true}else{n=l}this.insertHTML('<span id="Medium-wedge"></span>');var p=h.getElementById("Medium-wedge"),o=p.parentNode,m=0;p.removeAttribute("id");if(j){while(m<n.length){k.push(n[m]);m++}while(n.length>0){o.insertBefore(n[n.length-1],p)}}else{k.push(n);o.insertBefore(n,p)}o.removeChild(p);p=null;return k},insertHTML:function(p,r){var l,q;if(e.getSelection){l=e.getSelection();if(l.getRangeAt&&l.rangeCount){q=l.getRangeAt(0);q.deleteContents();var m=h.createElement("div");m.innerHTML=p;var s=h.createDocumentFragment(),n,k;while((n=m.firstChild)){k=s.appendChild(n)}var j=s.firstChild;q.insertNode(s);if(k){q=q.cloneRange();q.setStartAfter(k);if(r){q.setStartBefore(j)}else{q.collapse(true)}l.removeAllRanges();l.addRange(q)}}}else{if((l=h.selection)&&l.type!="Control"){var o=l.createRange();o.collapse(true);l.createRange().pasteHTML(p);if(r){q=l.createRange();q.setEndPoint("StartToStart",o);q.select()}}}}}})(d);(function(i){i.Selection=function(){};i.Selection.prototype={saveSelection:function(){if(e.getSelection){var j=e.getSelection();if(j.rangeCount>0){return j.getRangeAt(0)}}else{if(h.selection&&h.selection.createRange){return h.selection.createRange()}}return null},restoreSelection:function(j){if(j){if(e.getSelection){var k=e.getSelection();k.removeAllRanges();k.addRange(j)}else{if(h.selection&&j.select){j.select()}}}}}})(d);(function(i){i.Toolbar=function(j,l){this.medium=j;var k=h.createElement("div");k.innerHTML=this.html;this.buttons=l;this.element=k.children[0];h.body.appendChild(this.element);this.active=false;this.busy=true;this.handledEvents={scroll:null,mouseup:null,keyup:null}};i.Toolbar.prototype={fixedClass:"Medium-toolbar-fixed",showClass:"Medium-toolbar-show",hideClass:"Medium-toolbar-hide",html:'<div class="Medium-toolbar">				<div class="Medium-tail-outer">					<div class="Medium-tail-inner"></div>				</div>				<div id="Medium-buttons"></div>				<table id="Medium-options">					<tbody>						<tr>						</tr>					</tbody>				</table>			</div>',setup:function(){this.handleScroll().handleMouseup().handleKeyup()},destroy:function(){a.removeEvent(e,"scroll",this.handledEvents.scroll).removeEvent(h,"mouseup",this.handledEvents.mouseup).removeEvent(h,"keyup",this.handledEvents.keyup)},handleScroll:function(){var j=this;a.addEvent(e,"scroll",this.handledEvents.scroll=function(){if(j.active){j.goToSelection()}});return this},handleMouseup:function(){var j=this;a.addEvent(h,"mouseup",this.handledEvents.mouseup=function(){if(i.activeElement===j.medium.element&&!j.busy){j.goToSelection()}});return this},handleKeyup:function(){var j=this;a.addEvent(h,"keyup",this.handledEvents.keyup=function(){if(i.activeElement===j.medium.element&&!j.busy){j.goToSelection()}});return this},goToSelection:function(){var l=this.getHighlighted(),m=l.boundary.top-5,k=this.element,j=k.style;if(e.scrollTop>0){a.addClass(k,this.fixedClass)}else{a.removeClass(k,this.fixedClass)}if(l!==null){if(l.range.startOffset===l.range.endOffset&&!l.text){a.removeClass(k,this.showClass).addClass(k,this.hideClass);this.active=false}else{a.removeClass(k,this.hideClass).removeClass(k,this.showClass);j.opacity=0.01;a.addClass(k,this.showClass);j.opacity=1;j.top=(m-65)+"px";j.left=((l.boundary.left+(l.boundary.width/2))-(k.clientWidth/2))+"px";this.active=true}}},getHighlighted:function(){var k=e.getSelection(),j=(k.anchorNode?k.getRangeAt(0):false);if(!j){return null}return{selection:k,range:j,text:a.trim(j.toString()),boundary:j.getBoundingClientRect()}}}})(d);(function(i){i.Undoable=function(m){var p=this,n=m.settings.element,q,l,j=new Undo.Stack(),o=Undo.Command.extend({constructor:function(r,s){this.oldValue=r;this.newValue=s},execute:function(){},undo:function(){n.innerHTML=this.oldValue;m.canUndo=j.canUndo();m.canRedo=j.canRedo();m.dirty=j.dirty()},redo:function(){n.innerHTML=this.newValue;m.canUndo=j.canUndo();m.canRedo=j.canRedo();m.dirty=j.dirty()}}),k=function(s){var r=n.innerHTML;if(s){l=n.innerHTML;j.execute(new o(l,l))}else{if(r!=l){if(!p.movingThroughStack){j.execute(new o(l,r));l=r;m.dirty=j.dirty()}a.triggerEvent(m.settings.element,"change")}}};this.medium=m;this.timer=q;this.stack=j;this.makeUndoable=k;this.EditCommand=o;this.movingThroughStack=false;a.addEvent(n,"keyup",function(r){if(r.ctrlKey||r.keyCode===f.z){a.preventDefaultEvent(r);return}clearTimeout(q);q=setTimeout(function(){k()},250)}).addEvent(n,"keydown",function(r){if(!r.ctrlKey||r.keyCode!==f.z){p.movingThroughStack=false;return}a.preventDefaultEvent(r);p.movingThroughStack=true;if(r.shiftKey){j.canRedo()&&j.redo()}else{j.canUndo()&&j.undo()}})}})(d);(function(i){i.Utilities={isCommand:function(m,o,n,l){if((m.modifier==="ctrl"&&o.ctrlKey)||(m.modifier==="cmd"&&o.metaKey)||(m.modifier==="auto"&&(o.ctrlKey||o.metaKey))){return n.call()}else{return l.call()}},isShift:function(n,m,l){if(n.shiftKey){return m.call()}else{return l.call()}},isModifier:function(m,o,l){var n=m.modifiers[o.keyCode];if(n){return l.call(null,n)}return false},special:(function(){var l={};l[f.backspace]=true;l[f.shift]=true;l[f.ctrl]=true;l[f.alt]=true;l[f["delete"]]=true;l[f.cmd]=true;return l})(),isSpecial:function(l){return typeof i.Utilities.special[l.keyCode]!=="undefined"},navigational:(function(){var l={};l[f.upArrow]=true;l[f.downArrow]=true;l[f.leftArrow]=true;l[f.rightArrow]=true;return l})(),isNavigational:function(l){return typeof i.Utilities.navigational[l.keyCode]!=="undefined"},addEvents:function(p,q,r){var o=0,n,s=q.split(" "),l=s.length,m=i.Utilities;for(;o<l;o++){n=s[o];if(n.length>0){m.addEvent(p,n,r)}}return i.Utilities},addEvent:function j(m,l,n){if(m.addEventListener){m.addEventListener(l,n,false)}else{if(m.attachEvent){m.attachEvent("on"+l,n)}else{m["on"+l]=n}}return i.Utilities},removeEvent:function k(m,l,n){if(m.removeEventListener){m.removeEventListener(l,n,false)}else{if(m.detachEvent){m.detachEvent("on"+l,n)}else{m["on"+l]=null}}return i.Utilities},preventDefaultEvent:function(l){if(l.preventDefault){l.preventDefault()}else{l.returnValue=false}return i.Utilities},stopPropagation:function(l){l=l||window.event;l.cancelBubble=true;if(l.stopPropagation!==undefined){l.stopPropagation()}return i.Utilities},isEventSupported:function(n,l){l="on"+l;var o=h.createElement(n.tagName),m=(l in o);if(!m){o.setAttribute(l,"return;");m=typeof o[l]=="function"}o=null;return m},triggerEvent:function(m,l){var n;if(h.createEvent){n=h.createEvent("HTMLEvents");n.initEvent(l,true,true);n.eventName=l;m.dispatchEvent(n)}else{n=h.createEventObject();m.fireEvent("on"+l,n)}return i.Utilities},deepExtend:function(l,o){var n,m;for(n in o){if(o.hasOwnProperty(n)){m=o[n];if(m!==undefined&&m!==null&&m.constructor!==undefined&&m.constructor===Object){l[n]=l[n]||{};i.Utilities.deepExtend(l[n],m)}else{l[n]=m}}}return l},pasteHook:function(x,t){x.makeUndoable();var p=h.createElement("div"),m=x.element,w,n,q,y=x.settings,u,r=h.body,v=r.parentNode,l=v.scrollTop,o=v.scrollLeft;p.className=y.cssClasses.pasteHook;p.setAttribute("contenteditable",true);r.appendChild(p);a.selectNode(p);v.scrollTop=l;v.scrollLeft=o;setTimeout(function(){u=a.text(p);m.focus();if(y.maxLength>0){w=a.text(m);n=w.length;q=n+u.length;if(q>n){u=u.substring(0,y.maxLength-n)}}a.detachNode(p);v.scrollTop=l;v.scrollLeft=o;t(u)},0);return i.Utilities},traverseAll:function(o,l,r){var n=o.childNodes,q=n.length,m=0,p;r=r||1;l=l||{};if(q>0){for(;m<q;m++){p=n[m];switch(p.nodeType){case 1:i.Utilities.traverseAll(p,l,r+1);if(l.element!==undefined){l.element(p,m,r,o)}break;case 3:if(l.fragment!==undefined){l.fragment(p,m,r,o)}}q=n.length;if(p===o.lastChild){m=q}}}return i.Utilities},trim:function(l){return l.replace(/^[\s]+|\s+$/g,"")},arrayContains:function(n,l){var m=n.length;while(m--){if(n[m]===l){return true}}return false},addClass:function(m,l){if(m.classList){m.classList.add(l)}else{m.className+=" "+l}return i.Utilities},removeClass:function(m,l){if(m.classList){m.classList.remove(l)}else{m.className=m.className.replace(new RegExp("(^|\\b)"+l.split(" ").join("|")+"(\\b|$)","gi")," ")}return i.Utilities},hasClass:function(m,l){if(m.classList){return m.classList.contains(l)}else{return new RegExp("(^| )"+l+"( |$)","gi").test(m.className)}},isHidden:function(l){return l.offsetWidth===0||l.offsetHeight===0},isVisible:function(l){return l.offsetWidth!==0||l.offsetHeight!==0},encodeHtml:function(l){return h.createElement("a").appendChild(h.createTextNode(l)).parentNode.innerHTML},text:function(l,m){if(m!==undefined){if(l===null){return this}if(l.textContent!==undefined){l.textContent=m}else{l.innerText=m}return this}else{if(l===null){return this}else{if(l.innerText!==undefined){return a.trim(l.innerText)}else{if(l.textContent!==undefined){return a.trim(l.textContent)}else{if(l.data!==undefined){return a.trim(l.data)}}}}}return""},changeTag:function(p,n){var m=h.createElement(n),o,l;o=p.firstChild;while(o){l=o.nextSibling;m.appendChild(o);o=l}p.parentNode.insertBefore(m,p);p.parentNode.removeChild(p);return m},detachNode:function(l){if(l.parentNode!==null){l.parentNode.removeChild(l)}return this},selectNode:function(n){var l,m;n.focus();if(h.body.createTextRange){l=h.body.createTextRange();l.moveToElementText(n);l.select()}else{if(e.getSelection){m=e.getSelection();l=h.createRange();l.selectNodeContents(n);m.removeAllRanges();m.addRange(l)}}return this},baseAtCaret:function(n){if(!n.isActive()){return null}var o=e.getSelection?e.getSelection():document.selection;if(o.rangeCount){var m=o.getRangeAt(0),l=m.endContainer;switch(l.nodeType){case 3:if(l.data&&l.data.length!=m.endOffset){return false}break}return l}return null},atCaret:function(m){var l=this.baseAtCaret(m)||{},n=m.element;if(l===false){return null}while(l&&l.parentNode!==n){l=l.parentNode}if(l&&l.nodeType==1){return l}return null},hide:function(l){l.style.display="none"},show:function(l){l.style.display=""},hideAnim:function(l){l.style.opacity=1},showAnim:function(l){l.style.opacity=0.01;l.style.display=""}}})(d);g.rangePrototype.insertNodeAtEnd=function(j){var i=this.cloneRange();i.collapse(false);i.insertNode(j);i.detach();this.setEndAfter(j)};return d}()),a=b.Utilities;if(typeof define==="function"&&define.amd){define(function(){return b})}else{if(typeof module!=="undefined"&&module.exports){module.exports=b}else{if(typeof this!=="undefined"){this.Medium=b}}}}).call(this,window,document);